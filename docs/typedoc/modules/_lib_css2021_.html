<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>&quot;lib/css2021&quot; | r2epub — Converting HTML/ReSpec documents to EPUB 3.3</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../assets/js/search.js" data-base="..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../index.html" class="title">r2epub — Converting HTML/ReSpec documents to EPUB 3.3</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../globals.html">Globals</a>
				</li>
				<li>
					<a href="_lib_css2021_.html">&quot;lib/css2021&quot;</a>
				</li>
			</ul>
			<h1>External module &quot;lib/css2021&quot;</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<section class="tsd-panel tsd-comment">
				<div class="tsd-comment tsd-typography">
					<div class="lead">
						<a href="#css-files-for-the-2021-version-of-the-process" id="css-files-for-the-2021-version-of-the-process" style="color: inherit; text-decoration: none;">
							<h2>CSS files (for the 2021 version of the Process)</h2>
						</a>
					</div>
					<p> Handling CSS mappings is a bit complicated because the W3C setup is not entirely consistent...</p>
					<p>In general, the HTML links to a style file of the sort
						<code>https://www.w3.org/StyleSheets/TR/2021/W3C-{specStatus}</code>. These files are all very simple:
						import a common <code>base.css</code> file and add a setting for the background image using the logo file
						(this is, usually, the left stripe in the text).
						The logo used with the name <code>https://www.w3.org/StyleSheets/TR/2021/logos/{specStatus}.svg</code>
						The references to the logo files use relative URL-s, which is just fine for the EPUB version.
						All these files
					must be copied into the zip file, and the HTML references must be changed to their relative equivalents.</p>
					<p>However… the complication, from EPUB&#39;s point of view, mostly for some older or rarely used specification versions. The complications
					may be:</p>
					<ul>
						<li>The logo references in those CSS files may be absolute URL-s</li>
						<li>The logo references may rely on content negotiation, ie, do not spell out whether an SVG or a PNG image is used for a logo (which does not work in an EPUB content)</li>
						<li>Some basic formats do not use logo at all.</li>
						<li>The references are not relying on the <code>2021</code> subtree of the <code>StyleSheets/TR/</code> directory of the W3C site</li>
					</ul>
					<p>The function below handles the exceptional cases separately by storing some css and png files in a <a href="https://www.ivan-herman.net/r2epub/2021/">fixed place</a> and copy the
					files from there (as opposed to using the W3C files directly). This is done instead of performing some extra CSS parsing.</p>
					<p>Furthermore, the core <code>base.css</code> file is also modified slightly:
						- the TOC related statements have been removed
						- some page breaking instructions are added
					- the margins/padding of the page is set on a different HTML element, see the <a href="./_lib_overview_.html">separate “overview” module</a> for further details.</p>
					<a href="#small-note-on-the-svg-logo-files" id="small-note-on-the-svg-logo-files" style="color: inherit; text-decoration: none;">
						<h3>Small note on the SVG Logo files</h3>
					</a>
					<p>Some of the SVG files include a <code>&lt;!DOCTYPE</code>, which leads to an error in epubcheck for EPUB 3.2. However, these are allowed in EPUB 3.3, and the errors may be safely ignored. The newer version of epubcheck accepts these
					SVG files. (All EPUB Reading System work well with included <code>&lt;!DOCTYPE</code>.)</p>
				</div>
			</section>
			<section class="tsd-panel-group tsd-index-group">
				<h2>Index</h2>
				<section class="tsd-panel tsd-index-panel">
					<div class="tsd-index-content">
						<section class="tsd-index-section tsd-is-external">
							<h3>Functions</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-function tsd-parent-kind-external-module tsd-is-external"><a href="_lib_css2021_.html#extract_css" class="tsd-kind-icon">extract_<wbr>css</a></li>
							</ul>
						</section>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group tsd-is-external">
				<h2>Functions</h2>
				<section class="tsd-panel tsd-member tsd-kind-function tsd-parent-kind-external-module tsd-is-external">
					<a name="extract_css" class="tsd-anchor"></a>
					<h3>extract_<wbr>css</h3>
					<ul class="tsd-signatures tsd-kind-function tsd-parent-kind-external-module tsd-is-external">
						<li class="tsd-signature tsd-kind-icon">extract_<wbr>css<span class="tsd-signature-symbol">(</span>global<span class="tsd-signature-symbol">: </span><a href="../interfaces/_lib_convert_.global.html" class="tsd-signature-type">Global</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="../interfaces/_lib_convert_.resourceref.html" class="tsd-signature-type">ResourceRef</a><span class="tsd-signature-symbol">[]</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in <a href="https://github.com/iherman/r2epub/blob/64bdfc7/src/lib/css2021.ts#L56">lib/css2021.ts:56</a></li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Extract/add the right CSS references and gathers all resources (logo files, watermark image, etc.) to be added to the overall set of resources in the final book. Note that the HTML DOM of the main file is modified on the fly:</p>
								</div>
								<ul>
									<li>The reference to the core CSS is changed to <code>base.css</code>.</li>
									<li>The background/watermark handling is stored in a separate, extra CSS file, whose reference is added to the document.</li>
								</ul>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>global: <a href="../interfaces/_lib_convert_.global.html" class="tsd-signature-type">Global</a></h5>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <a href="../interfaces/_lib_convert_.resourceref.html" class="tsd-signature-type">ResourceRef</a><span class="tsd-signature-symbol">[]</span></h4>
							<ul>
								<li>list of extracted additional resources</li>
							</ul>
						</li>
					</ul>
				</section>
			</section>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="../globals.html"><em>Globals</em></a>
					</li>
					<li class="label tsd-is-external">
						<span>Internals</span>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="_r2epub_.html">&quot;r2epub&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="_server_.html">&quot;server&quot;</a>
					</li>
					<li class="label tsd-is-external">
						<span>Externals</span>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_args_.html">&quot;clib/args&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_chapter_.html">&quot;clib/chapter&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_convert_.html">&quot;clib/convert&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_cover_.html">&quot;clib/cover&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_nav_.html">&quot;clib/nav&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_opf_.html">&quot;clib/opf&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_clib_title_.html">&quot;clib/title&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_index_.html">&quot;index&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_common_.html">&quot;lib/common&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_convert_.html">&quot;lib/convert&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_cover_.html">&quot;lib/cover&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_css2016_.html">&quot;lib/css2016&quot;</a>
					</li>
					<li class="current tsd-kind-external-module tsd-is-external">
						<a href="_lib_css2021_.html">&quot;lib/css2021&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_fetch_.html">&quot;lib/fetch&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_home_.html">&quot;lib/home&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_nav_.html">&quot;lib/nav&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_ocf_.html">&quot;lib/ocf&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_opf_.html">&quot;lib/opf&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_overview_.html">&quot;lib/overview&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_title_.html">&quot;lib/title&quot;</a>
					</li>
					<li class=" tsd-kind-external-module tsd-is-external">
						<a href="_lib_utils_.html">&quot;lib/utils&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-function tsd-parent-kind-external-module tsd-is-external">
						<a href="_lib_css2021_.html#extract_css" class="tsd-kind-icon">extract_<wbr>css</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer>
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="overlay"></div>
<script src="../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../assets/js/search.js"><' + '/script>');</script>
</body>
</html>