<!DOCTYPE html>
<html>
<head>
  <title>&quot;@iherman&#x2F;r2epub&quot; documentation</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="doc-current-file" content="">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="page.css">
  <link id="ddocResetStylesheet" rel="stylesheet" href="reset.css"><link href="comrak.css" rel="stylesheet" /><link href="prism.css" rel="stylesheet" /><script src="prism.js"></script><script src="script.js" defer></script>
  <script src="darkmode_toggle.js"></script><script src="search_index.js" defer></script>
    <script src="fuse.js" defer></script>
    <script src="search.js" defer></script></head>
<body>
<div class="ddoc">
<div><nav id="topnav">
  <div class="h-full">
    <div class="flex items-center"><ul class="breadcrumbs"><li>&quot;@iherman&#x2F;r2epub&quot;</li></ul>
</div>

    <div class="flex items-center gap-2">
      <button id="theme-toggle" type="button" aria-label="Toggle dark mode" style="display: none;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 1.992a10 10 0 1 0 9.236 13.838c.341 -.82 -.476 -1.644 -1.298 -1.31a6.5 6.5 0 0 1 -6.864 -10.787l.077 -.08c.551 -.63 .113 -1.653 -.758 -1.653h-.266l-.068 -.006l-.06 -.002z" />
</svg>
<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class=hidden>
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M12 19a1 1 0 0 1 .993 .883l.007 .117v1a1 1 0 0 1 -1.993 .117l-.007 -.117v-1a1 1 0 0 1 1 -1z" />
  <path d="M18.313 16.91l.094 .083l.7 .7a1 1 0 0 1 -1.32 1.497l-.094 -.083l-.7 -.7a1 1 0 0 1 1.218 -1.567l.102 .07z" />
  <path d="M7.007 16.993a1 1 0 0 1 .083 1.32l-.083 .094l-.7 .7a1 1 0 0 1 -1.497 -1.32l.083 -.094l.7 -.7a1 1 0 0 1 1.414 0z" />
  <path d="M4 11a1 1 0 0 1 .117 1.993l-.117 .007h-1a1 1 0 0 1 -.117 -1.993l.117 -.007h1z" />
  <path d="M21 11a1 1 0 0 1 .117 1.993l-.117 .007h-1a1 1 0 0 1 -.117 -1.993l.117 -.007h1z" />
  <path d="M6.213 4.81l.094 .083l.7 .7a1 1 0 0 1 -1.32 1.497l-.094 -.083l-.7 -.7a1 1 0 0 1 1.217 -1.567l.102 .07z" />
  <path d="M19.107 4.893a1 1 0 0 1 .083 1.32l-.083 .094l-.7 .7a1 1 0 0 1 -1.497 -1.32l.083 -.094l.7 -.7a1 1 0 0 1 1.414 0z" />
  <path d="M12 2a1 1 0 0 1 .993 .883l.007 .117v1a1 1 0 0 1 -1.993 .117l-.007 -.117v-1a1 1 0 0 1 1 -1z" />
  <path d="M12 7a5 5 0 1 1 -4.995 5.217l-.005 -.217l.005 -.217a5 5 0 0 1 4.995 -4.783z" />
</svg>
</button>

        <input
          type="text"
          id="searchbar"
          style="display: none;"
          class="py-2 px-2.5 mx-1 rounded text-sm border border-gray-300 bg-transparent dark:bg-gray-800 dark:border-gray-700"
          />
    </div>
  </div>
</nav>
<div id="searchResults"></div><div id="content">
    <main><section>
  <div class="space-y-2 flex-1"><div class="space-y-7" id="module_doc"><div class="markdown"><h1 id="respec-to-epub">
ReSpec to EPUB</h1>
<p>Typescript program to convert W3C documents, produced by <a href="https://respec.org/docs/">ReSpec</a>, to EPUB 3.4.</p>
<h2 id="single-documents-vs.-collections">
Single documents vs. Collections</h2>
<p>The conversion can:</p>
<ul>
<li>Convert a single HTML source produced by <a href="https://respec.org/docs/">ReSpec</a>.</li>
<li>Convert a single HTML source that must be pre-processed by <a href="https://respec.org/docs/">ReSpec</a> to get its final formats; the program pre-processes the source on the fly.</li>
<li>Convert and combine a “collection“ of HTML sources (to be pre-processed or not) into a single EPUB 3 document.</li>
</ul>
<p>(The on-the-fly conversion via ReSpec is done by running the <a href="https://github.com/w3c/spec-generator">W3C’s Spec Generator service</a>. Alas!, that service may be down or slow, and this package has no control over that…)</p>
<h2 id="package-usage">
Package usage</h2>
<h3 id="command-line-usage">
Command line usage</h3>
<p>There is a simple command line interface to run the script. See the the separate <a href="https://iherman.github.io/r2epub/doc/cli/">documentation on cli</a> for details and examples.</p>
<h3 id="run-a-service-via-http">
Run a service via HTTP</h3>
<p>There is also the possibility to start a simple server to generate EPUB 3.4 instances on request. See the separate <a href="https://iherman.github.io/r2epub/doc/serve/">documentation on the server</a> for details and examples of HTTP requests.</p>
<p>The server has been deployed on the cloud at <a href="https://labs.w3.org/r2epub">W3C</a> using the <code>https://labs.w3.org/r2epub</code> URL. A <a href="https://iherman.github.io/r2epub/convert.html">browser interface</a> to drive this server is also available. (Note that the server running on W3C is also used to generate an EPUB version of a document based on respec directly from the respec <code>export</code> facility.)</p>
<h3 id="use-as-a-typescript-package-through-an-api">
Use as a typescript package through an API</h3>
<p>The program can be run from <code>deno</code> (relying on the jsr package <a href="https://jsr.io/@iherman/r2epub"><code>@iherman/r2epub</code></a>). See the separate <a href="https://iherman.github.io/r2epub/doc/">documentation on the API</a> for details and examples of the API usage.</p>
<h4 id="environment-variables">
Environment variables</h4>
<ul>
<li>
<p><strong><code>PORT</code> or <code>R2EPUB_PORT</code>:</strong> the port number used by the server; failing these the default (i.e., 80) is used. (<code>PORT</code> takes precedence over <code>R2EPUB_PORT</code>.)</p>
</li>
<li>
<p><strong><code>R2EPUB_LOCAL</code>:</strong> no URL-s on <code>localhost</code> are accepted, unless this environment variable set (the value of the variable is not relevant, only the setting is). For security reasons this variable should not be set for deployed servers and its usage is advised for local testing purposes only.</p>
</li>
<li>
<p><strong><code>R2EPUB_MODIFIED_EPUB_FILES</code>:</strong> A number of W3C specific files (logos, some css files) had to be adapted for EPUB 3 usage, and are retrieved from a separate site. At the moment, <code>https://www.w3.org/People/Ivan/r2epub/</code> is used as a base URL for those files. If the environment variable is set, its value is used as a prefix for the copy of the files on the local file system and the files are read directly from the disc.</p>
<p>(The local clone of the distribution has a copy of all the necessary files, too, and can be used for local testing via <code>localhost</code>. Some server may have problems with a burst of access to the same base URL resulting in run-time error, hence the advantage to use this local alternative to setup.)</p>
</li>
</ul>
<h3 id="usage">
Usage</h3>
<p>Once installed locally, follow specific instructions based on your needs/interest below:</p>
<h4 id="command-line">
Command Line</h4>
<pre class="highlight"><code class="language-sh">deno run -A r2epub.ts
</code><button class="copyButton" data-copy="deno run -A r2epub.ts
"><svg class="copy" width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="2" y="2" width="7" height="7" fill="none"/>
<rect x="6" y="6" width="7" height="7" fill="none"/>
<path d="M1.55566 2.7C1.55566 2.03726 2.09292 1.5 2.75566 1.5H8.75566C9.41841 1.5 9.95566 2.03726 9.95566 2.7V5.1H12.3557C13.0184 5.1 13.5557 5.63726 13.5557 6.3V12.3C13.5557 12.9627 13.0184 13.5 12.3557 13.5H6.35566C5.69292 13.5 5.15566 12.9627 5.15566 12.3V9.9H2.75566C2.09292 9.9 1.55566 9.36274 1.55566 8.7V2.7ZM6.35566 9.9V12.3H12.3557V6.3H9.95566V8.7C9.95566 9.36274 9.41841 9.9 8.75566 9.9H6.35566ZM8.75566 8.7V2.7H2.75566V8.7H8.75566Z" fill="currentColor"/>
</svg>
<svg class="check" width="15" height="15" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
<path stroke="none" d="M0 0h24v24H0z" fill="none" />
<path d="M5 12l5 5l10 -10" />
</svg>
</button><code></code></pre>
<p>starts the command line interface.</p>
<h4 id="server">
Server</h4>
<pre class="highlight"><code class="language-sh">deno run -A serve.ts
</code><button class="copyButton" data-copy="deno run -A serve.ts
"><svg class="copy" width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="2" y="2" width="7" height="7" fill="none"/>
<rect x="6" y="6" width="7" height="7" fill="none"/>
<path d="M1.55566 2.7C1.55566 2.03726 2.09292 1.5 2.75566 1.5H8.75566C9.41841 1.5 9.95566 2.03726 9.95566 2.7V5.1H12.3557C13.0184 5.1 13.5557 5.63726 13.5557 6.3V12.3C13.5557 12.9627 13.0184 13.5 12.3557 13.5H6.35566C5.69292 13.5 5.15566 12.9627 5.15566 12.3V9.9H2.75566C2.09292 9.9 1.55566 9.36274 1.55566 8.7V2.7ZM6.35566 9.9V12.3H12.3557V6.3H9.95566V8.7C9.95566 9.36274 9.41841 9.9 8.75566 9.9H6.35566ZM8.75566 8.7V2.7H2.75566V8.7H8.75566Z" fill="currentColor"/>
</svg>
<svg class="check" width="15" height="15" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
<path stroke="none" d="M0 0h24v24H0z" fill="none" />
<path d="M5 12l5 5l10 -10" />
</svg>
</button><code></code></pre>
<p>starts up the server locally.</p>
<h2 id="externally-accessible-entry-points">
Externally accessible entry points</h2>
<p>r2epub can also be used as a library module both to TypeScript and to Javascript. A simple example In Typescript (using <code>deno</code>) is as follows:</p>
<pre class="highlight"><code class="language-js">import * as r2epub  from 'jsr:@iherman/r2epub';
import * as fs      from 'node:fs';

// The creation itself is asynchronous (the content has to be fetched over the wire).
// The result is the class instance encapsulating an OCF (zip) content
const url :string = &quot;http://www.example.org/doc.html&quot;,
const args :r2epub.Options = {
    respec : false,
    config : {}
};
const ocf :r2epub.OCF = await r2epub.convert(url, args);

// The zip file is finalized asynchronously; it is a Buffer or an ArrayBuffer, depending on the run-time environment
const content = await ocf.get_content();

// Get the content out to the disk
fs.writeFileSync(ocf.name, content);
</code><button class="copyButton" data-copy="import * as r2epub  from 'jsr:@iherman/r2epub';
import * as fs      from 'node:fs';

// The creation itself is asynchronous (the content has to be fetched over the wire).
// The result is the class instance encapsulating an OCF (zip) content
const url :string = &quot;http://www.example.org/doc.html&quot;,
const args :r2epub.Options = {
    respec : false,
    config : {}
};
const ocf :r2epub.OCF = await r2epub.convert(url, args);

// The zip file is finalized asynchronously; it is a Buffer or an ArrayBuffer, depending on the run-time environment
const content = await ocf.get_content();

// Get the content out to the disk
fs.writeFileSync(ocf.name, content);
"><svg class="copy" width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="2" y="2" width="7" height="7" fill="none"/>
<rect x="6" y="6" width="7" height="7" fill="none"/>
<path d="M1.55566 2.7C1.55566 2.03726 2.09292 1.5 2.75566 1.5H8.75566C9.41841 1.5 9.95566 2.03726 9.95566 2.7V5.1H12.3557C13.0184 5.1 13.5557 5.63726 13.5557 6.3V12.3C13.5557 12.9627 13.0184 13.5 12.3557 13.5H6.35566C5.69292 13.5 5.15566 12.9627 5.15566 12.3V9.9H2.75566C2.09292 9.9 1.55566 9.36274 1.55566 8.7V2.7ZM6.35566 9.9V12.3H12.3557V6.3H9.95566V8.7C9.95566 9.36274 9.41841 9.9 8.75566 9.9H6.35566ZM8.75566 8.7V2.7H2.75566V8.7H8.75566Z" fill="currentColor"/>
</svg>
<svg class="check" width="15" height="15" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
<path stroke="none" d="M0 0h24v24H0z" fill="none" />
<path d="M5 12l5 5l10 -10" />
</svg>
</button><code></code></pre>
<p>The same can be done in <code>node.js</code> by installing the <code>r2epub</code> package from <code>npm</code>. (See warning in the introduction.)</p>
<p>See the detailed specification of the API elements. The top level functional entry point to the package is <a href="https://iherman.github.io/r2epub/convert.html">convert</a>.</p>
<hr />
<p>Copyright © 2025 <a href="https://www.ivan-herman.net">Ivan Herman</a> (a.k.a. <a href="https://github.com/iherman">@iherman</a>).</p>
</div></div>
</div>
</section>
</main><div class="toc">
    <div><nav class="topSymbols">
          <h3>Symbols</h3>
          <ul><li>
                <a href=".&#x2F;lib&#x2F;common.ts&#x2F;~&#x2F;ENV_MODIFIED_FILE_LOCATION.html" title="ENV_MODIFIED_FILE_LOCATION"><div class="docNodeKindIcon"><div class="text-Variable bg-Variable/15 dark:text-VariableDark dark:bg-VariableDark/15" title="Variable">v</div></div>
<span class="hover:bg-Variable/15 hover:bg-VariableDark/15">
                    ENV_MODIFIED_FILE_LOCATION
                  </span>
                </a>
              </li><li>
                <a href=".&#x2F;.&#x2F;~&#x2F;OCF.html" title="OCF"><div class="docNodeKindIcon"><div class="text-Class bg-Class/15 dark:text-ClassDark dark:bg-ClassDark/15" title="Class">c</div></div>
<span class="hover:bg-Class/15 hover:bg-ClassDark/15">
                    OCF
                  </span>
                </a>
              </li><li>
                <a href=".&#x2F;lib&#x2F;common.ts&#x2F;~&#x2F;Options.html" title="Options"><div class="docNodeKindIcon"><div class="text-Interface bg-Interface/15 dark:text-InterfaceDark dark:bg-InterfaceDark/15" title="Interface">I</div></div>
<span class="hover:bg-Interface/15 hover:bg-InterfaceDark/15">
                    Options
                  </span>
                </a>
              </li><li>
                <a href=".&#x2F;.&#x2F;~&#x2F;RespecToEPUB.html" title="RespecToEPUB"><div class="docNodeKindIcon"><div class="text-Class bg-Class/15 dark:text-ClassDark dark:bg-ClassDark/15" title="Class">c</div></div>
<span class="hover:bg-Class/15 hover:bg-ClassDark/15">
                    RespecToEPUB
                  </span>
                </a>
              </li><li>
                <a href=".&#x2F;.&#x2F;~&#x2F;convert.html" title="convert"><div class="docNodeKindIcon"><div class="text-Function bg-Function/15 dark:text-FunctionDark dark:bg-FunctionDark/15" title="Function">f</div></div>
<span class="hover:bg-Function/15 hover:bg-FunctionDark/15">
                    convert
                  </span>
                </a>
              </li></ul><a class="flex items-center gap-0.5" href=".&#x2F;all_symbols.html">
              <span class="leading-none">view all 61 symbols</span><svg
	width="16"
	height="16"
	viewBox="0 0 16 16"
	fill="none"
	xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M5.76748 11.8159C5.5378 11.577 5.54525 11.1972 5.78411 10.9675L8.93431 8L5.78411 5.0325C5.54525 4.80282 5.5378 4.423 5.76748 4.18413C5.99715 3.94527 6.37698 3.93782 6.61584 4.1675L10.2158 7.5675C10.3335 7.68062 10.4 7.83679 10.4 8C10.4 8.16321 10.3335 8.31938 10.2158 8.4325L6.61584 11.8325C6.37698 12.0622 5.99715 12.0547 5.76748 11.8159Z" fill="currentColor" />
</svg>
</a></nav><nav class="documentNavigation">
          <h3>Document Navigation</h3><ul><li><a href="#respec-to-epub" title="ReSpec to EPUB">ReSpec to EPUB</a></li><li><ul><li><a href="#single-documents-vs.-collections" title="Single documents vs. Collections">Single documents vs. Collections</a></li><li><a href="#package-usage" title="Package usage">Package usage</a></li><li><ul><li><a href="#command-line-usage" title="Command line usage">Command line usage</a></li><li><a href="#run-a-service-via-http" title="Run a service via HTTP">Run a service via HTTP</a></li><li><a href="#use-as-a-typescript-package-through-an-api" title="Use as a typescript package through an API">Use as a typescript package through an API</a></li><li><ul><li><a href="#environment-variables" title="Environment variables">Environment variables</a></li></ul></li><li><a href="#usage" title="Usage">Usage</a></li><li><ul><li><a href="#command-line" title="Command Line">Command Line</a></li><li><a href="#server" title="Server">Server</a></li></ul></li><li><a href="#externally-accessible-entry-points" title="Externally accessible entry points">Externally accessible entry points</a></li></ul></li></ul></li></ul></nav></div>
  </div></div>
</div>
</div>
</body>
</html>
